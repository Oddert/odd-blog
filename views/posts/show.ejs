<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title><%= data.title %> | Odd-Blog</title>
    <link rel="stylesheet" href="/css/master.css" />
    <link rel="stylesheet" href="/css/show.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=0.666667, maximum-scale=0.666667, user-scalable=0">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/png" href="/faveicon.png">
  </head>
  <body>
    <% include ../partials/nav %>

    <% if (/\w/gi.test(data.header_image.src)) { %>
      <figure class="header_image">
        <img src="<%= data.header_image.src %>" alt="<%= data.header_image.src %>" />
        <figcaption><%= data.header_image.caption %></figcaption>
      </figure>
    <% } %>

    <article class="main post_show">

      <h1 class="title"><%= data.title %></h1>
      <h2 class="subtitle"><%= data.subtitle %></h2>
      <div class="details">
        <div class="details_wrapper">
          <div class="details_image">
            <a href="/user/<%= data.author.username %>">
              <figure>
                <img src="<%= data.author.user.profile %>" alt="<%= data.author.user.username %>'s Profile Image'">
              </figure>
            </a>
          </div>
          <div class="details_text">
            <p class="details_author">By <a href="/user/<%= data.author.username %>"><strong><%= /\w/gi.test(data.author.displayName) ? data.author.displayName : data.author.username %></strong></a></p>
            <p><strong><%= new Date(data.created).toLocaleDateString() %></strong></p>
            <p><em>Read Time: <%= data.word_count < 265 ? '1 min' : Math.ceil(data.word_count/265) > 1 ? Math.ceil(data.word_count/265)+' mins' : Math.ceil(data.word_count/265)+' min' %></em></p>
          </div>
          <% if (user && data.author.id == user._id) { %>
            <a href="/posts/<%= data._id %>/edit">Edit</a>
            <div class="delete_control">
              <button class="delete_prompt">Delete</button>
              <form action="/posts/<%= data._id %>?_method=DELETE" method="POST" class="delete_form hide">
                <p>Are you sure you want to delete?</p>
                <button class="cancel">Cancel</button>
                <button class="delete">Delete</button>
              </form>
            </div>
          <% } %>
        </div>
      </div>
      <% data.inputs.forEach(item => { %>

        <% if (/\w/gi.test(item.subhead)) { %>
          <h3 class="subhead"># <%= item.subhead %></h3>
        <% } %>

        <% if (item.data_type == "paragraph" && /\w/gi.test(item.text[0])) { %>
          <div class="paragraph <%= item.align %>">
            <% item.text.forEach(section => { %>
              <p class="section"><%- section %></p>
            <% }) %>
            <hr />
          </div>
        <% } %>

        <% if (item.data_type == "image" && /\w/gi.test(item.src)) { %>
          <figure class="image <%= item.align %>">
            <img src="<%= item.src %>" alt="<%= item.alt %>">
            <figcaption><%= item.caption %></figcaption>
            <hr />
          </figure>
        <% } %>

        <% if (item.data_type == "quote" && /\w/gi.test(item.text)) { %>
          <blockquote cite="<%= item.cite %>" class="quote <%= item.align %>">
            <p><%= item.text %></p>
            <footer>- <%= item.author %></footer>
          </blockquote>
        <% } %>

      <% }) %>

      <div class="article_social">
        <p>Share this post:</p>
        <div class="links">
          <a href="https://twitter.com/intent/tweet?text=<%= location %>posts/<%= data._id %>/ <%= data.title %> -By <%= data.author.displayName %>" class="social twitter" title="Share on Twitter" target="_blank"><i class="fab fa-3x fa-twitter"></i></a>
          <a href="https://www.facebook.com/sharer.php?u=<%= location %>posts/<%= data._id %>" class="social facebook" title="Share on Facebook" target="_blank"><i class="fab fa-3x fa-facebook"></i></a>
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=<%= location %>posts/<%= data._id %>&title=<%= data.title %>&summary=<%= data.subtitle %>&source=<%= blog_name %>" class="social linkedin" title="Share on Linkedin" target="_blank"><i class="fab fa-3x fa-linkedin"></i></a>
          <button class="social link" title="Copy Link" target="_blank" data-link="<%= location %>posts/<%= data._id %>"><i class="fas fa-3x fa-link"></i></button>
        </div>
        <div class="notifier">
          <p>Copied: "<span><%= location %>posts/<%= data._id %></span>" to clipboard.</p>
        </div>
      </div>

    </article>
    <footer>
      <div class="author_bio__container">
        <div class="tags">
          <% data.tags.forEach(each => { %>
            <a href="/tags/?tag=<%= each %>" class="tag"><%= each %></a>
          <% }) %>
        </div>
        <div class="author_bio">
        <!-- <a href="/user/<%= data.author.user.username %>"> -->
        <!-- </a> -->
          <figure class="author_bio__profile">
              <img src="<%= data.author.user.profile %>" alt="Profile image for <%= data.author.user.username %>" />
          </figure>
          <div class="author_bio_main">
            <div class="author_bio__names">
              <% if (/\w/gi.test(data.author.user.primary_name) && data.author.user.primary_name !== undefined) { %>
                <h3><a href="/user/<%= data.author.user.username %>"><%= data.author.user.primary_name ? data.author.user.primary_name : '' %> <%= data.author.user.other_names.length > 0 ? data.author.user.other_names.join(' ') + ' ' : '' %><%= data.author.user.secondary_name %></a></h3>
              <% } %>
              <h4><em><a href="/user/<%= data.author.user.username %>">@ <%= data.author.user.username %></a></em></h4>
            </div>
            <div class="author_bio__outward">
              <p><%= data.author.user.bio_forward_facing %></p>
            </div>
          </div>
          <div class="author_bio__social">
            <% data.author.user.links.forEach(each => { %>
              <% if (each.link_type == "twitter") { %>
                <a href="<%= each.src %>" class="social twitter"><i class="fab fa-2x fa-twitter"></i></a>
              <% } %>
              <% if (each.link_type == "facebook") { %>
                <a href="<%= each.src %>" class="social facebook"><i class="fab fa-2x fa-facebook"></i></a>
              <% } %>
              <% if (each.link_type == "linkedin") { %>
                <a href="<%= each.src %>" class="social linkedin"><i class="fab fa-2x fa-linkedin"></i></a>
              <% } %>
              <% if (each.link_type == "web") { %>
                <a href="<%= each.src %>" class="social link"><i class="fab fa-2x fa-link"></i></a>
              <% } %>
            <% }) %>
          </div>
        </div>
      </div>

      <h3 class="read_more">Read More:</h3>
      <div class="read_more__lables">
        <% if (previousPost) { %>
          <p>Previous</p>
        <% } %>
        <% if (nextPost) { %>
          <p>Next</p>
        <% } %>
      </div>
      <div class="other_posts">
        <% if (previousPost) { %>
          <div class="previous">
          <div class="post">
            <% if (previousPost.header_image.src && /\w/gi.test(previousPost.header_image.src)) { %>
              <a href="/posts/<%= previousPost._id %>" class="image">
                <img src="<%= previousPost.header_image.src %>" alt="<%= previousPost.header_image.alt %>" class="other_posts__header_image" title="<%= previousPost.header_image.caption %>" />
              </a>
            <% } %>
            <div class="details">
              <div class="details_primary">
                <h3><a href="/posts/<%= previousPost._id %>"><%= previousPost.title %></a></h3>
                <% if (previousPost.subtitle.length > 150) { %>
                  <p><%= previousPost.subtitle.substring(0,150) %>...</p>
                <% } else { %>
                  <p><%= previousPost.subtitle %></p>
                <% } %>
                <p class="read_button"><a href="/posts/<%= previousPost._id %>">Read Post <i class="fas fa-chevron-right"></i></a></p>
              </div>
              <div class="details_meta">
                <h4 class="details_author">By <a href="/user/<%= previousPost.author.username %>"><%= /\w/gi.test(previousPost.author.displayName) ? previousPost.author.displayName : previousPost.author.username %></a></h4>
                <strong><%= new Date(previousPost.created).toLocaleDateString() %></strong>
                <p class="details_read_time"><em>Read Time: <%= previousPost.word_count < 265 ? '1 min' : Math.ceil(previousPost.word_count/265) > 1 ? Math.ceil(previousPost.word_count/265)+' mins' : Math.ceil(previousPost.word_count/265)+' min' %></em></p>
              </div>
              <% if (user && previousPost.author.id.equals(user._id)) { %>
                <div class="modify">
                  <a href="/posts/<%= previousPost._id %>/edit">Edit</a>
                  <div class="delete_control">
                    <button class="delete_prompt">Delete</button>
                    <form action="/posts/<%= previousPost._id %>?_method=DELETE" method="POST" class="delete_form hide">
                      <p>Are you sure you want to delete?</p>
                      <button class="cancel">Cancel</button>
                      <button class="delete">Delete</button>
                    </form>
                  </div>
                  <% if (previousPost.deleted) { %>
                    <a href="/dev/<%= previousPost._id %>/undelete" title="Post is NOT visable to the public, only admins">POST DELETED. Click to un-delete</a>
                    <% } %>
                </div>
              <% } %>
            </div>
          </div>
        </div>
        <% } %>
        <% if (nextPost) { %>
          <div class="next">
          <div class="post">
            <% if (nextPost.header_image.src && /\w/gi.test(nextPost.header_image.src)) { %>
              <!-- <a href="/posts/<%= nextPost.year %>/<%= nextPost.month %>/<%= nextPost.day %>/<%= nextPost.title %>" class="image"> -->
              <a href="/posts/<%= nextPost._id %>" class="image">
                <img src="<%= nextPost.header_image.src %>" alt="<%= nextPost.header_image.alt %>" class="other_posts__header_image" title="<%= nextPost.header_image.caption %>" />
              </a>
            <% } %>
            <div class="details">
              <div class="details_primary">
                <h3><a href="/posts/<%= nextPost._id %>"><%= nextPost.title %></a></h3>
                <% if (nextPost.subtitle.length > 150) { %>
                  <p><%= nextPost.subtitle.substring(0,150) %>...</p>
                <% } else { %>
                  <p><%= nextPost.subtitle %></p>
                <% } %>
                <p class="read_button"><a href="/posts/<%= nextPost._id %>">Read Post <i class="fas fa-chevron-right"></i></a></p>
              </div>
              <div class="details_meta">
                <h4 class="details_author">By <a href="/user/<%= nextPost.author.username %>"><%= /\w/gi.test(nextPost.author.displayName) ? nextPost.author.displayName : nextPost.author.username %></a></h4>
                <strong><%= new Date(nextPost.created).toLocaleDateString() %></strong>
                <p class="details_read_time"><em>Read Time: <%= nextPost.word_count < 265 ? '1 min' : Math.ceil(nextPost.word_count/265) > 1 ? Math.ceil(nextPost.word_count/265)+' mins' : Math.ceil(nextPost.word_count/265)+' min' %></em></p>
              </div>
              <% if (user && nextPost.author.id.equals(user._id)) { %>
                <div class="modify">
                  <a href="/posts/<%= nextPost._id %>/edit">Edit</a>
                  <div class="delete_control">
                    <button class="delete_prompt">Delete</button>
                    <form action="/posts/<%= nextPost._id %>?_method=DELETE" method="POST" class="delete_form hide">
                      <p>Are you sure you want to delete?</p>
                      <button class="cancel">Cancel</button>
                      <button class="delete">Delete</button>
                    </form>
                  </div>
                  <% if (nextPost.deleted) { %>
                    <a href="/dev/<%= nextPost._id %>/undelete" title="Post is NOT visable to the public, only admins">POST DELETED. Click to un-delete</a>
                    <% } %>
                </div>
              <% } %>
            </div>
          </div>
        </div>
        <% } %>
      </div>

    </footer>
  </body>
  <!-- <script type="text/javascript" src="/js/name.js"></script> -->
  <script type="text/javascript" src="/js/index.js"></script>
</html>
